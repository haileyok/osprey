import re
import unicodedata
from typing import Dict, List

from osprey.engine.executor.execution_context import ExecutionContext
from osprey.engine.udf.arguments import ArgumentsBase
from osprey.engine.udf.base import UDFBase

# a collection of lookalike characters that we have found useful (and have been used in the wild during e.g. raids)
lookalikes = {
    'a': [
        'ğ°',
        'a',
        'ï½',
        'ğ‘',
        'ğ—®',
        'ğ•’',
        'ğ–†',
        'ğ“ª',
        'ğšŠ',
        'ğª',
        'Ğ°',
        'É‘',
        'Î±',
        'ğ”',
        'ğ’‚',
        'ğ˜¢',
        'ğ›‚',
        'âº',
        'ğ’¶',
        'ğ™–',
        'ğœ¶',
        'ğ›¼',
        'ğš',
        'ğ–º',
        'ğ™°',
        'A',
        'ğ´',
        'á—…',
        'ğ‘¨',
        'ğš¨',
        'ğ•¬',
        'ğ– ',
        'Ğ',
        'Î‘',
        'ğ›¢',
        'ğ–',
        'ğ’œ',
        'ğœœ',
        'ğ–½€',
        'ğ“',
        'ğ',
        'ï¼¡',
        'ğ—”',
        'ğ˜ˆ',
        'áª',
        'ê“®',
        'ğ€',
        'ğ”„',
        'ğ”¸',
        'ğŠ ',
        'ğ˜¼',
        'a',
        'Ğ°',
        'áº¡',
        'Ä…',
        'Ã¤',
        'Ã ',
        'Ã¡',
        'Ä…',
        '4',
        '@',
        '^',
        'Î±',
        'Ğ°',
        'x',
        '*',
        '_',
        '-',
    ],
    'b': [
        'ğ‘',
        'ğ—¯',
        'b',
        'Æ„',
        'ğ•“',
        'ğ–‡',
        'Ğ¬',
        'ğ“«',
        'ğš‹',
        'á',
        'á–¯',
        'ğ”Ÿ',
        'á‘²',
        'ğ’ƒ',
        'ğ˜£',
        'ğ’·',
        'ğ™—',
        'ğ›',
        'ğ–»',
        'B',
        'ğ•­',
        'ğ™±',
        'ğ‘©',
        'ğš©',
        'ê“',
        'Î’',
        'Ğ’',
        'ğœ',
        'ğ›£',
        'ğ–¡',
        'ğ—',
        'ğŠ‚',
        'ğŒ',
        'ğ—•',
        'ï¼¢',
        'ğ“‘',
        'ğ‘',
        'ğ”…',
        'â„¬',
        'ğ˜‰',
        'ğ˜½',
        'ê´',
        'á´',
        'ğ',
        'á—·',
        'ğŠ¡',
        'ğµ',
        'ğ”¹',
        'b',
        '8',
    ],
    'c': [
        'ğ‘',
        'ğ—°',
        'Ñ',
        'c',
        'ï½ƒ',
        'ğ•”',
        'á´„',
        'â²¥',
        'ğ½',
        'ğ–ˆ',
        'ğ“¬',
        'ğšŒ',
        'ê®¯',
        'ğ” ',
        'Ï²',
        'ğ’„',
        'ğ˜¤',
        'ğ’¸',
        'ğ™˜',
        'ğœ',
        'ğ–¼',
        'â…½',
        'â„‚',
        'ğ•®',
        'C',
        'ğ™²',
        'ğ‘ª',
        'ğ’',
        'ğ–¢',
        'ğŒ‚',
        'ğ—–',
        'ê“š',
        'áŸ',
        'ğ”œ',
        'Ğ¡',
        'ï¼£',
        'â²¤',
        'ğ“’',
        'â…­',
        'â„­',
        'ğ˜Š',
        'ğ•',
        'ğ˜¾',
        'ğŸŒ',
        'ğ‚',
        'ğ‘£²',
        'ğ‘£©',
        'Ï¹',
        'ğŠ¢',
        'ğ¶',
        'c',
        'Ñ',
        'Æˆ',
        'Ä‹',
        '(',
        '<',
        'Â©',
        'k',
        '[',
        '{',
    ],
    'd': [
        'Ô',
        'ğ“­',
        'ğš',
        'd',
        'â…†',
        'ğ‘‘',
        'ğ—±',
        'á§',
        'ğ’…',
        'ğ˜¥',
        'ğ–‰',
        'á‘¯',
        'ê“’',
        'ğ',
        'ğ–½',
        'ğ”¡',
        'ğ••',
        'â…¾',
        'ğ’¹',
        'ğ™™',
        'á ',
        'ğ•¯',
        'D',
        'â……',
        'ğ““',
        'ğ™³',
        'ğ”‡',
        'á—ª',
        'ğ‘«',
        'ğ˜‹',
        'â…®',
        'ğ’Ÿ',
        'ğ˜¿',
        'ê““',
        'ğƒ',
        'ğ–£',
        'ğ·',
        'ğ——',
        'ğ”»',
        'á—',
        'd',
        'Ô',
        'É—',
    ],
    'e': [
        'ğ“®',
        'ğš',
        'e',
        'ï½…',
        'ğ‘’',
        'ğ—²',
        'â…‡',
        'ğ’†',
        'ğ˜¦',
        'â„®',
        'ğ–Š',
        'â„¯',
        'ğ',
        'ğ–¾',
        'ê¬²',
        'Ğµ',
        'ğ”¢',
        'ğ•–',
        'Ò½',
        'ğ™š',
        'ğ•°',
        'ğ™´',
        'E',
        'ğ›¦',
        'ğ‘¬',
        'ğš¬',
        'ğœ ',
        'ğ–¤',
        'Î•',
        'Ğ•',
        'ğ—˜',
        'ğŠ†',
        'ğš',
        'ğ“”',
        'ğ”',
        'ï¼¥',
        'ğ”ˆ',
        'ğ˜Œ',
        'á¬',
        'â„°',
        'ğ™€',
        'ê“°',
        'ğ‘¢®',
        'ğ„',
        'ğ¸',
        'â´¹',
        'ğ‘¢¦',
        'ğ”¼',
        'â‹¿',
        'e',
        'Ğµ',
        'áº¹',
        'Ä—',
        'Ã©',
        'Ã¨',
        '3',
        'â‚¬',
        'Ñ”',
        'âˆ‘',
        'x',
        '*',
        '_',
        '-',
    ],
    'f': [
        'ğ“¯',
        'ğš',
        'Ö„',
        'ğ‘“',
        'ğ—³',
        'f',
        'ğ’‡',
        'ğ˜§',
        'ğ–‹',
        'ğŸ',
        'ğ–¿',
        'ğ”£',
        'ê¬µ',
        'ğ•—',
        'ê™',
        'ğ’»',
        'ğ™›',
        'áº',
        'Å¿',
        'ğ‘­',
        'ğˆ“',
        'F',
        'ğ•±',
        'ğ‘¢¢',
        'ğ–¥',
        'ê˜',
        'ğ“•',
        'Ïœ',
        'ğŠ‡',
        'ê“',
        'ğ—™',
        'ğ”¥',
        'ğ˜',
        'ğ‘£‚',
        'ğ…',
        'ğŸŠ',
        'ğ”‰',
        'â„±',
        'ğ”½',
        'á–´',
        'ğ™',
        'ğ™µ',
        'ğŠ¥',
        'ğ¹',
        'f',
    ],
    'g': [
        'ğ“°',
        'ğš',
        'É¡',
        'Ö',
        'á¶ƒ',
        'ğ‘”',
        'ğ—´',
        'g',
        'ï½‡',
        'ğ’ˆ',
        'ğ˜¨',
        'â„Š',
        'ğ–Œ',
        'Æ',
        'ğ ',
        'ğ—€',
        'ğ”¤',
        'ğ•˜',
        'ğ™œ',
        'á€',
        'ğ‘®',
        'ğ˜',
        'ğ•²',
        'G',
        'ğ†',
        'ğ–¦',
        'ÔŒ',
        'ğ”Š',
        'ğ”¾',
        'á³',
        'ğ’¢',
        'ğ™‚',
        'ê“–',
        'ğ“–',
        'ğ™¶',
        'ğº',
        'ğ—š',
        'g',
        'Ä¡',
        'q',
        '9',
        '6',
        '&',
        'Â©',
    ],
    'h': [
        'á‚',
        'ğ–',
        'ğ“±',
        'ğš‘',
        'h',
        'ï½ˆ',
        'ğ”¥',
        'â„',
        'ğ’‰',
        'ğ˜©',
        'Õ°',
        'ğ’½',
        'ğ™',
        'ğ¡',
        'ğ—',
        'ğ—µ',
        'Ò»',
        'ğ•™',
        'ğ‘¯',
        'ğš®',
        'ğ•³',
        'H',
        'ğ›¨',
        'ğ–§',
        'â„‹',
        'â„Œ',
        'â„',
        'â²',
        'ğ‹',
        'ğœ¢',
        'Î—',
        'ğ“—',
        'ğ–',
        'ğœ',
        'ğ—›',
        'Ğ',
        'ğ˜',
        'ê“§',
        'ï¼¨',
        'ğ‡',
        'ğ™ƒ',
        'ğ™·',
        'á»',
        'á•¼',
        'ğ»',
        'h',
        'Ò»',
        '#',
    ],
    'i': [
        'ğ“²',
        'ğ²',
        'ê™‡',
        'â…ˆ',
        'ï½‰',
        'ğ”¦',
        'ğ˜ª',
        'Ó',
        'ğ™',
        'ğš¤',
        'ğ¢',
        'Ñ–',
        'ğ‘–',
        'Ë›',
        'ğ•š',
        'ğ–',
        'á¥',
        'ğš’',
        'ğ‘£ƒ',
        'i',
        'É©',
        'Éª',
        'ğ’Š',
        'ğ›Š',
        'â…°',
        'Ä±',
        'ğ’¾',
        'ğœ¾',
        'â³',
        'ğœ„',
        'ê­µ',
        'ğ—‚',
        'ğ¸',
        'â„¹',
        'Î¹',
        'ğ—¶',
        'Íº',
        'ğš°',
        'ğ˜­',
        'Ğ†',
        'ğ–¨',
        'ğ¥',
        'ïº',
        'ïº',
        'ğ”©',
        'â„',
        'â„‘',
        'ğŠŠ',
        'â²’',
        'ğŒ‰',
        'â„“',
        'ğœ¤',
        'Æ–',
        'ğ˜',
        'Î™',
        'ğš•',
        'ğŸ',
        'âˆ£',
        'Ø§',
        'ï¼©',
        'ğ—…',
        'ğ•€',
        '1',
        'ğ™„',
        'ğ“',
        'ğŒ ',
        'ğ¼',
        'ğ¸€',
        'ğº€',
        '×€',
        'ğ‘°',
        'Ç€',
        'Ó€',
        'á›',
        'ğŸ­',
        'ğ•´',
        'I',
        'ßŠ',
        'ï½Œ',
        'ğ›ª',
        'âµ',
        'ğ',
        'ğ•',
        'ğŸ£',
        '×•',
        'ğ£‡',
        'ğ™¡',
        'ğ“˜',
        'ğ—œ',
        'ğŸ™',
        'ğ‘™',
        '×Ÿ',
        'â… ',
        'ğ˜',
        'Ù¡',
        'ğ’',
        'ğ–‘',
        'ï¿¨',
        'ğŸ¯±',
        'ğˆ',
        'l',
        'Û±',
        'ê“²',
        'ğ–¼¨',
        'ğ™¸',
        'ğŸ·',
        'ğ“µ',
        '|',
        'â…¼',
        'â½',
        'ğ—¹',
        'i',
        'Ñ–',
        'Ã­',
        'Ã¯',
        '1',
        '!',
        'l',
        'x',
        '|',
        'âˆ«',
        '*',
        '_',
        '-',
    ],
    'j': [
        'ğ–',
        'ğ“³',
        'ğš“',
        'â…‰',
        'ğ”§',
        'j',
        'ï½Š',
        'ğ’‹',
        'ğ˜«',
        'ğ’¿',
        'ğ™Ÿ',
        'Ï³',
        'ğ£',
        'ğ—ƒ',
        'Ñ˜',
        'ğ‘—',
        'ğ—·',
        'ğ•›',
        'ğ”',
        'ğ‘±',
        'ğ˜‘',
        'Ğˆ',
        'J',
        'ï¼ª',
        'ğ’¥',
        'ğ™…',
        'á«',
        'á’',
        'ğ‰',
        'ğ–©',
        'ê²',
        'ğ½',
        'ğ—',
        'ğ•',
        'ê“™',
        'ğ•µ',
        'ğ“™',
        'ğ™¹',
        'Í¿',
        'j',
        'Ñ˜',
        'Ê',
    ],
    'k': [
        'ğ–',
        'ğ“´',
        'ğš”',
        'ğ”¨',
        'k',
        'ğ’Œ',
        'ğ˜¬',
        'ğ“€',
        'ğ™ ',
        'ğ¤',
        'ğ—„',
        'ğ‘˜',
        'ğ—¸',
        'ğ•œ',
        'ğ‘²',
        'ğš±',
        'ğ’¦',
        'K',
        'ğœ¥',
        'ğ›«',
        'ğ–ª',
        'ğŸ',
        'ğ—',
        'â²”',
        'á›•',
        'ê“—',
        'Îš',
        'Ğš',
        'ğ“š',
        'ğ™',
        'ğ”',
        'ğ˜’',
        'á¦',
        'ğ™†',
        'ï¼«',
        'ğ”˜',
        'ğŠ',
        'ğ¾',
        'ğ•‚',
        'ğ•¶',
        'ğ™º',
        'k',
        'Îº',
        'c',
        '<',
        '[',
        '{',
        'Â©',
    ],
    'l': [
        'ğš°',
        'ğ˜­',
        'Ğ†',
        'ğ–¨',
        'ğ¥',
        'ïº',
        'ïº',
        'ğ”©',
        'â„',
        'â„‘',
        'ğŠŠ',
        'â²’',
        'ğŒ‰',
        'â„“',
        'ğœ¤',
        'Æ–',
        'ğ˜',
        'Î™',
        'ğš•',
        'ğŸ',
        'âˆ£',
        'Ø§',
        'ï¼©',
        'ğ—…',
        'ğ•€',
        '1',
        'ğ™„',
        'ğ“',
        'ğŒ ',
        'ğ¼',
        'ğ¸€',
        'ğº€',
        '×€',
        'ğ‘°',
        'Ç€',
        'Ó€',
        'á›',
        'ğŸ­',
        'ğ•´',
        'I',
        'ßŠ',
        'ï½Œ',
        'ğ›ª',
        'âµ',
        'ğ',
        'ğ•',
        'ğŸ£',
        '×•',
        'ğ£‡',
        'ğ™¡',
        'ğ“˜',
        'ğ—œ',
        'ğŸ™',
        'ğ‘™',
        '×Ÿ',
        'â… ',
        'ğ˜',
        'Ù¡',
        'ğ’',
        'ğ–‘',
        'ï¿¨',
        'ğŸ¯±',
        'ğˆ',
        'l',
        'Û±',
        'ê“²',
        'ğ–¼¨',
        'ğ™¸',
        'ğŸ·',
        'ğ“µ',
        '|',
        'â…¼',
        'â½',
        'ğ—¹',
        'ğ–¼–',
        'ğ‘³',
        'ğ‘¢£',
        'L',
        'ğ–«',
        'â³',
        'ğ—Ÿ',
        'â„’',
        'ğ“›',
        'á',
        'ğ”¦',
        'ğ”',
        'ê“¡',
        'ğ›',
        'ğ˜“',
        'ğ™‡',
        'á’ª',
        'â…¬',
        'ğˆª',
        'ğ‹',
        'ğ¿',
        'ğ•ƒ',
        'ğ‘¢²',
        'ğ•·',
        'ğ™»',
        'l',
        'Ó',
        'á¸·',
        'i',
        '1',
        '!',
        'l',
        'x',
        '|',
        'âˆ«',
        '*',
        '_',
        '-',
    ],
    'm': [
        'ğ‘œ€',
        'ğ’',
        'ğ˜®',
        'ğ‘££',
        'ğ–’',
        'ğ¦',
        'ğ—†',
        'm',
        'ğ”ª',
        'ğ•',
        'ğ“‚',
        'ğ™¢',
        'ğ“¶',
        'ğš–',
        'rn',
        'ğ‘š',
        'ğ—º',
        'â…¿',
        'ğ›­',
        'ğ‘´',
        'ğš³',
        'ğœ§',
        'ğŒ‘',
        'ğ–¬',
        'M',
        'ğ— ',
        'á›–',
        'ğ¡',
        'â²˜',
        'ğ“œ',
        'Îœ',
        'Ğœ',
        'ğ›',
        'ê“Ÿ',
        'ğ”',
        'ğ˜”',
        'ğ™ˆ',
        'ğŠ°',
        'ğŒ',
        'ï¼­',
        'â…¯',
        'ğ‘€',
        'á—°',
        'â„³',
        'ğ•„',
        'á·',
        'ğ•¸',
        'Ïº',
        'ğ™¼',
        'm',
    ],
    'n': [
        'ğ’',
        'ğ˜¯',
        'ğ–“',
        'ğ§',
        'ğ—‡',
        'ğ”«',
        'n',
        'ğ•Ÿ',
        'ğ“ƒ',
        'ğ™£',
        'Õ¸',
        'ğ“·',
        'ğš—',
        'Õ¼',
        'ğ‘›',
        'ğ—»',
        'ê“ ',
        'ğ›®',
        'ğ',
        'ğ–­',
        'ğš´',
        'ğ”‘',
        'ğœ¨',
        'ğ”“',
        'N',
        'ï¼®',
        'ğ’©',
        'ğ™‰',
        'ğ“',
        'ğ™½',
        'â„•',
        'ğ¢',
        'ğ‘',
        'ğ—¡',
        'â²š',
        'ğ‘µ',
        'ğ˜•',
        'ğœ',
        'Î',
        'ğ•¹',
        'n',
        'Õ¸',
    ],
    'o': [
        'ğ˜°',
        'à°‚',
        'à²‚',
        'à´‚',
        'à¶‚',
        'Ö…',
        'ğ¨',
        'ğ‘£—',
        'ğ”¬',
        'á´',
        'á´‘',
        'ğ¹¤',
        'ğ“ª',
        'ğš˜',
        'ğ‘£ˆ',
        'á€',
        'â²Ÿ',
        'ğ›',
        'à´ ',
        'ğ›”',
        'ï®¦',
        'ï®§',
        'ğ—ˆ',
        'ğˆ',
        'ï®¨',
        'ï®©',
        'ï®ª',
        'ï®«',
        'ï®¬',
        'ï®­',
        'ğº„',
        'â„´',
        'ğ„',
        'ğ¸',
        'ğ¼',
        'ê¬½',
        'Ğ¾',
        'Ú¾',
        'Î¿',
        'á€',
        'Û',
        'Ïƒ',
        'Ù‡',
        'ï½',
        'à¹',
        'à»',
        'ğ• ',
        'ğ¬',
        'ğ¸¤',
        'ğ™¤',
        'Û•',
        'ğ‘œ',
        'ğ’',
        '×¡',
        'ğœ',
        'ğ–”',
        'Ù¥',
        'à¥¦',
        'à©¦',
        'à«¦',
        'à¯¦',
        'à±¦',
        'à³¦',
        'àµ¦',
        'ï»©',
        'ï»ª',
        'ï»«',
        'ï»¬',
        'ğœŠ',
        'o',
        'ğ¾',
        'Ûµ',
        'ğ‚',
        'ğ“¸',
        'ğ—¼',
        'áƒ¿',
        'ß€',
        'ğ›°',
        'ğ‘£ ',
        'ğ–®',
        'ã€‡',
        'ğŠ’',
        'ğŸ¬',
        'ğ’ª',
        'ğœª',
        'O',
        'á‹',
        'ğ“',
        'ğ',
        'ğ¤',
        'âµ”',
        'Õ•',
        'ğŸ¢',
        'ğ—¢',
        'ğŸ˜',
        'ğ˜–',
        'â²',
        'Ğ',
        'ÎŸ',
        'à¬ ',
        'ğŸ',
        'ğ',
        'à§¦',
        'à­¦',
        'ğ”’',
        'ğŸ¯°',
        'ğ•†',
        'ğ™Š',
        'ğ”–',
        'ï¼¯',
        '0',
        'ğ‘“',
        'ğŠ«',
        'ğ™¾',
        'ê“³',
        'ğ‘¢µ',
        'ğ‘‚',
        'ğ„',
        'ğŸ¶',
        'ğ‘¶',
        'ğš¶',
        'ğ“‚',
        'ğ•º',
        'o',
        'Ğ¾',
        'Î¿',
        'Ö…',
        'È¯',
        'á»',
        'á»',
        'Æ¡',
        'Ã³',
        'Ã²',
        'Ã¶',
        '0',
        '*',
        '_',
        '-',
    ],
    'p': [
        'Ñ€',
        'Ï',
        'ğ”­',
        'ğ˜±',
        'ğ™¥',
        'ğ©',
        'ï½',
        'ğ› ',
        'ğ‘',
        'ğ•¡',
        'ğ–•',
        'ğœš',
        'ğš™',
        'ğ',
        'â²£',
        'ğ”',
        'ğ›’',
        'ğ’‘',
        'ğŸˆ',
        'ğ†',
        'ğ“…',
        'ğœŒ',
        'ğ—‰',
        'p',
        'ğ€',
        'Ï±',
        'ğ—½',
        'â´',
        'ğº',
        'ğ“¹',
        'ğ–¯',
        'ğ›²',
        'ğ¦',
        'ğœ¬',
        'ğ’«',
        'ğŠ•',
        'P',
        'ğ ',
        'ğ“Ÿ',
        'ê“‘',
        'ğ—£',
        'â„™',
        'ğ˜—',
        'Ğ ',
        'ğ',
        'Î¡',
        'â²¢',
        'á¢',
        'ğ”“',
        'ğ™‹',
        'á‘­',
        'ï¼°',
        'ğ™¿',
        'ğ‘ƒ',
        'ğš¸',
        'ğ‘·',
        'ğ•»',
        'p',
        'Ñ€',
    ],
    'q': [
        'ğ”®',
        'Õ£',
        'ğ’’',
        'ğ˜²',
        'Õ¦',
        'ğ“†',
        'ğ™¦',
        'ğª',
        'ğ—Š',
        'q',
        'ğ‘',
        'ğ—¾',
        'ğ•¢',
        'ğ––',
        'Ô›',
        'ğ“º',
        'ğšš',
        'ğ',
        'ğ–°',
        'ğ””',
        'ğ’¬',
        'ğ™Œ',
        'ğ“ ',
        'ğš€',
        'Q',
        'ğ‘„',
        'ğ—¤',
        'âµ•',
        'ğ‘¸',
        'ğ˜˜',
        'â„š',
        'ğ•¼',
        'q',
        'Õ¦',
    ],
    'r': [
        'ğ”¯',
        'ê®',
        'ğ’“',
        'ğ˜³',
        'â²…',
        'á´¦',
        'ê­‡',
        'ê­ˆ',
        'ğ“‡',
        'ğ™§',
        'ğ«',
        'ğ—‹',
        'ğ‘Ÿ',
        'ğ—¿',
        'r',
        'Ğ³',
        'ğ•£',
        'ğ–—',
        'ğ“»',
        'ğš›',
        'á¡',
        'ğ–¼µ',
        'ğ™',
        'ê“£',
        'Æ¦',
        'ğ‘',
        'ğ–±',
        'á–‡',
        'ğ’´',
        'ğ‘…',
        'ğ—¥',
        'R',
        'á’',
        'ğ•½',
        'ğ“¡',
        'ğš',
        'ğˆ–',
        'â„›',
        'â„œ',
        'â„',
        'ğ‘¹',
        'ğ˜™',
        'r',
        'Ğ¯',
    ],
    's': [
        'ğ”°',
        'ğ‘£',
        'ğ’”',
        'ğ˜´',
        'ğ“ˆ',
        'ğ™¨',
        'ê®ª',
        'ğ¬',
        'ğ—Œ',
        'ğ‘ ',
        'ğ˜€',
        'êœ±',
        's',
        'ï½“',
        'ğ•¤',
        'Ñ•',
        'ğ–˜',
        'ğ“¼',
        'ğšœ',
        'ğ‘ˆ',
        'Æ½',
        'ğ’®',
        'ğ™',
        'ê“¢',
        'ğ–¼º',
        'ğ ',
        'Ğ…',
        'ğ’',
        'ğ–²',
        'ğ‘†',
        'ğ—¦',
        'ğŠ–',
        'ğ•Š',
        'Õ',
        'ğ•¾',
        'S',
        'ï¼³',
        'á•',
        'ğ“¢',
        'ğš‚',
        'ğ”–',
        'áš',
        'ğ‘º',
        'ğ˜š',
        's',
        'Ê‚',
        '5',
        '$',
        'z',
        'Â§',
        '2',
        'Å›',
    ],
    't': [
        'ğ­',
        'ğ—',
        'ğ”±',
        'ğ•¥',
        'ğ“‰',
        'ğ™©',
        'ğ“½',
        'ğš',
        't',
        'ğ‘¡',
        'ğ˜',
        'ğ’•',
        'ğ˜µ',
        'ğ–™',
        'ğ’¯',
        'ğœ¯',
        'ğ–³',
        'ğ—§',
        'ğŠ—',
        'ğŒ•',
        'ğ©',
        'ğŸ¨',
        'T',
        'ê“”',
        'ğ–¼Š',
        'ğ“£',
        'ğ£',
        'âŸ™',
        'ğ”—',
        'ğ˜›',
        'ğ™',
        'Ğ¢',
        'á¢',
        'âŠ¤',
        'Î¤',
        'ğ“',
        'â²¦',
        'ğ‘‡',
        'ğŠ±',
        'ğ•‹',
        'ğ‘¢¼',
        'ğ•¿',
        'ï¼´',
        'ğšƒ',
        'ğ›µ',
        'ğ‘»',
        'ğš»',
        't',
        '7',
        '+',
        'â€ ',
    ],
    'u': [
        'ğ®',
        'Ï…',
        'ğ”²',
        'ğ‘£˜',
        'ğ•¦',
        'Ê‹',
        'ğ™ª',
        'ê­',
        'ğ“¶',
        'ğš',
        'ê­’',
        'ğ‘¢',
        'ğ’–',
        'ğ›–',
        'á´œ',
        'ğ–š',
        'êŸ',
        'ğœ',
        'ğ—',
        'ğ“Š',
        'ğŠ',
        'ğ“¾',
        'ğ¾',
        'ğ„',
        'u',
        'ğ˜‚',
        'ğ˜¶',
        'Õ½',
        'ğ’°',
        'ğ™',
        'áˆ€',
        'â‹ƒ',
        'ğ”',
        'ğ–´',
        'ğ‘ˆ',
        'ğ—¨',
        'ğ‘¢¸',
        'âˆª',
        'ğ•Œ',
        'á‘Œ',
        'Õ',
        'ğ–€',
        'ğ“¤',
        'ğš„',
        'ê“´',
        'U',
        'ğ“',
        'ğ”˜',
        'ğ‘¼',
        'ğ˜œ',
        'ğ–½‚',
        'u',
        'Ï…',
        'Õ½',
        'Ã¼',
        'Ãº',
        'Ã¹',
        'v',
        'Âµ',
        'x',
        '*',
        '_',
        '-',
    ],
    'v': [
        'â‹',
        'ğ¯',
        'ğ”³',
        'ğ•§',
        'ğ™«',
        'ğšŸ',
        'ğ‘£',
        'ï½–',
        '×˜',
        'ğ’—',
        'ğ–›',
        'á´ ',
        'ğ—',
        'ğ‘£€',
        'ğ›',
        'âˆ¨',
        'ğœˆ',
        'ê®©',
        'ğ“‹',
        'ğ“¿',
        'â…´',
        'ğ˜ƒ',
        'Ñµ',
        'v',
        'ğ‚',
        'ğ˜·',
        'ğ¶',
        'ğ‘œ†',
        'ğ¼',
        'Î½',
        'ğ‘¢ ',
        'ğˆ',
        'ğ’±',
        'ğ“¥',
        'ğ—©',
        'ğ˜',
        'V',
        'ğ–¼ˆ',
        'á™',
        'ğ•',
        'ğ”™',
        'ê›Ÿ',
        'ğ•',
        'â…¤',
        'ê“¦',
        'Ù§',
        'ğ™‘',
        'ğ”',
        'ğš…',
        'ğ‘‰',
        'á¯',
        'ğ‘½',
        'Ñ´',
        'Û·',
        'ğ–',
        'â´¸',
        'ğ–µ',
        'v',
        'Î½',
        'Ñµ',
        'u',
    ],
    'w': [
        'ğ°',
        'ğ—',
        'á´¡',
        'Ñ¡',
        'Õ¡',
        'ê®ƒ',
        'ğ”´',
        'ğ•¨',
        'ğ“Œ',
        'ğ™¬',
        'É¯',
        'ğ”€',
        'ğš ',
        'ğ‘œ',
        'ğ‘œ',
        'ğ‘¤',
        'ğ˜„',
        'w',
        'ğ’˜',
        'ğ˜¸',
        'ğ–œ',
        'Ô',
        'ğ‘œŠ',
        'ğ•',
        'ğ’²',
        'ğ™’',
        'ğ“¦',
        'ğš†',
        'ê“ª',
        'ğ‘Š',
        'ğ—ª',
        'ğ‘£¯',
        'ğ‘¾',
        'ğ˜',
        'á³',
        'á”',
        'ğ–‚',
        'W',
        'ğ–',
        'ğ–¶',
        'ğ‘£¦',
        'Ôœ',
        'ğ”š',
        'w',
    ],
    'x': [
        'á•',
        'ğ“',
        'ğ™­',
        'Ñ…',
        'ğ±',
        'ğ—‘',
        'â¤«',
        'ğ‘¥',
        'ğ˜…',
        'â¤¬',
        'á™®',
        'â¨¯',
        'ğ•©',
        'ğ–',
        'Ã—',
        'ğ”',
        'ğš¡',
        'x',
        'ï½˜',
        'â…¹',
        'ğ”µ',
        'á•½',
        'ğ’™',
        'ğ˜¹',
        'ğ’³',
        'ğœ²',
        'ğ“§',
        'ğ¦',
        'ğŠ',
        'ğ¬',
        'ğŒ—',
        'ğ—«',
        'ğ˜Ÿ',
        'X',
        'ğ—',
        'ğ”›',
        'âµ',
        'ğ”§',
        'ğ•',
        'ğ™“',
        'Ğ¥',
        'Î§',
        'â…©',
        'ğš‡',
        'ê“«',
        'â²¬',
        'á™­',
        'ğ‘‹',
        'ğŠ´',
        'ğ‘¿',
        'ğš¾',
        'â•³',
        'ê³',
        'ğ–ƒ',
        'áš·',
        'ï¼¸',
        'ğ›¸',
        'ğŒ¢',
        'ğ–·',
        'ğ‘£¬',
        'x',
        'Ñ…',
        'Ò³',
        'Ã—',
        'X',
    ],
    'y': [
        'ğ™®',
        'Ñƒ',
        'ğ²',
        'ğ²',
        'ğ‘¦',
        'á¶Œ',
        'ğ¬',
        'ğ‘£œ',
        'ğ•ª',
        'Ê',
        'ğ–',
        'ğš¢',
        'ï½™',
        'ê­š',
        'ğ’š',
        'ğ“',
        'É£',
        'ğ—’',
        'áƒ§',
        'ğ˜†',
        'Ò¯',
        'ğ›¾',
        'Î³',
        'ğ›„',
        'ğ”‚',
        'ğœ¸',
        'y',
        'ğ”¶',
        'â„½',
        'ğ˜º',
        'á»¿',
        'ğœ°',
        'ğ’´',
        'ğ‘¢¤',
        'ğ“¨',
        'ğ—¬',
        'ğª',
        'ğ˜ ',
        'Ï’',
        'ğ–½ƒ',
        'ğ¤',
        'ğ˜',
        'Y',
        'ğ”œ',
        'ğ•',
        'Ğ£',
        'ğ™”',
        'Î¥',
        'ğšˆ',
        'â²¨',
        'á©',
        'ğŠ²',
        'ğ‘Œ',
        'ê“¬',
        'Ò®',
        'ğ’€',
        'ğ–„',
        'ğ–¸',
        'ï¼¹',
        'ğ›¶',
        'ğš¼',
        'á½',
        'y',
        'Ñƒ',
        'Ã½',
        'Â¥',
        'Î»',
        'Ê',
    ],
    'z': [
        'ğ“',
        'ğ™¯',
        'á´¢',
        'ğ³',
        'ğ—“',
        'ğ‘£„',
        'ğ‘§',
        'ğ˜‡',
        'ğ•«',
        'ğ–Ÿ',
        'ê®“',
        'ğ”ƒ',
        'ğš£',
        'ğ”·',
        'z',
        'ğ’›',
        'ğ˜»',
        'ğ—­',
        'ğš­',
        'áƒ',
        'ğ‘£¥',
        'ğ›§',
        'ğ“©',
        'Î–',
        'ğ˜¡',
        'ğœ¡',
        'Z',
        'ğ™•',
        'ğ•',
        'ê“œ',
        'ğ›',
        'ğ™',
        'ğ‘',
        'â„¤',
        'â„¨',
        'ğ–…',
        'ğ‹µ',
        'ğš‰',
        'ğ’',
        'ğ‘¢©',
        'ï¼º',
        'ğ’µ',
        'ğ–¹',
        'z',
        'Ê',
        'Å¼',
        '2',
        'â‰¥',
        's',
        'Î¶',
    ],
    '.': ['.'],
    ' ': [' '],
    "'": ["'"],
    '"': ['"'],
    '@': ['@'],
    '/': ['/'],
}


def censorize(tok: str, char_set: Dict[str, List[str]] = lookalikes) -> List[str]:
    """Generate all variations of a token based on character replacements."""
    tok_variations = ['']

    for char in tok:
        char_variations = char_set.get(char)
        # if there wasn't one, just use the char itself
        if char_variations is None:
            char_variations = [char]

        new_tok_variations: List[str] = []
        for tok_variation in tok_variations:
            for char_variation in char_variations:
                new_tok_variations.append(tok_variation + char_variation)
        tok_variations = new_tok_variations

    return tok_variations


def create_censorize_regex(
    tok: str,
    include_plural: bool,
    include_substrings: bool,
    char_set: Dict[str, List[str]],
) -> str:
    """Create a regex pattern for matching variations of a token."""

    tok = tok.lower()

    regex = ''
    if not include_substrings:
        regex += r'(^|\W)'

    for index, char in enumerate(tok):
        char_variations = char_set.get(char)
        if char_variations is None:
            char_variations = [char]

        regex += '['
        for char_variation in char_variations:
            regex += re.escape(char_variation)
        regex += ']'

        if index < len(tok) - 1:
            regex += r'(,.+/|&%#!@_)*'

    if include_plural:
        s_variations = char_set.get('s', ['s'])
        regex += '['
        for s_variation in s_variations:
            regex += re.escape(s_variation)
        regex += ']?'

    if not include_substrings:
        regex += r'(\W|$)'

    return regex


def regex_multiple(substrs: bool, *strs: str) -> List[re.Pattern[str]]:
    """Create multiple regex patterns."""
    regs: List[re.Pattern[str]] = []
    for s in strs:
        regs.append(regex(s, False, substrs))
    return regs


def regex(tok: str, include_plural: bool, include_substrings: bool) -> re.Pattern[str]:
    """Create a compiled regex pattern for matching token variations."""
    return re.compile(create_censorize_regex(tok, include_plural, include_substrings, lookalikes))


space_chars_regex = re.compile(r'[*âˆ—Ù­ê­ˆğŒŸ]')
underlines_regex = re.compile('[\u035a-\u035f]')


def remove_space_chars(text: str) -> str:
    """Remove space-like characters from text."""
    return space_chars_regex.sub('', text)


def remove_underlines(text: str) -> str:
    """Remove combining marks (underlines) from text. Example would be b_i_t_c_h or f___u___c___k turning into bitch or fuck."""
    output: List[str] = []
    for char in text:
        if not unicodedata.category(char).startswith('Mn'):
            output.append(char)
    return ''.join(output)


def remove_single_quotes(text: str) -> str:
    """Remove single quotes from text."""
    return text.replace("'", '')


def remove_zero_width_space(text: str) -> str:
    """Remove zero-width spaces from text."""
    text = text.replace('\u200b', '')
    text = text.replace('\u200e', '')
    return text


def clean(text: str) -> str:
    """Clean text by removing zero-width spaces and underlines."""
    text = remove_zero_width_space(text)
    text = remove_underlines(text)
    return text


class CensorCache:
    def __init__(self) -> None:
        self._cache: Dict[str, re.Pattern[str]] = {}

    def get_censorized_regex(self, term: str, plurals: bool, substrings: bool) -> re.Pattern[str]:
        cache_key = term
        if plurals:
            cache_key = f'{cache_key}-yp'
        if substrings:
            cache_key = f'{cache_key}-ysbs'

        if cache_key not in self._cache:
            pattern = regex(term, include_plural=plurals, include_substrings=substrings)
            self._cache[cache_key] = pattern

        return self._cache[cache_key]


censor_cache = CensorCache()


class CheckCensorizedArguments(ArgumentsBase):
    s: str
    pattern: str
    plurals: bool = False
    substrings: bool = False
    must_be_censorized: bool = False


class CheckCensorized(UDFBase[CheckCensorizedArguments, bool]):
    def execute(self, execution_context: ExecutionContext, arguments: CheckCensorizedArguments) -> bool:
        pattern = censor_cache.get_censorized_regex(
            arguments.pattern, plurals=arguments.plurals, substrings=arguments.substrings
        )

        match = pattern.search(arguments.s)
        if match is None:
            return False

        if arguments.must_be_censorized:
            if match.group().lower() == arguments.pattern.lower():
                return False

        return True


class CleanStringArguments(ArgumentsBase):
    s: str
    zero_width: bool = True
    underlines: bool = True
    space_likes: bool = False
    single_quotes: bool = False


class CleanString(UDFBase[CleanStringArguments, str]):
    def execute(self, execution_context: ExecutionContext, arguments: CleanStringArguments) -> str:
        return self._execute(arguments)

    def _execute(self, arguments: CleanStringArguments) -> str:
        s = arguments.s
        if arguments.zero_width:
            s = remove_zero_width_space(s)
        if arguments.underlines:
            s = remove_underlines(s)
        if arguments.space_likes:
            s = remove_space_chars(s)
        if arguments.single_quotes:
            s = remove_single_quotes(s)
        return s
